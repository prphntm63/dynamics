<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="styles.css">
    <title>Dynamics Tests</title>
</head>
<body onkeydown="move(event)" onkeyup="stop(event)">
    <div class='box' id='box'>
    </div>

    <script>

        var refreshLeft;
        var refreshRight;
        var jump;
        var jumpAllowed = true;
        var repeatAllowedLeft = true;
        var repeatAllowedRight = true;
        var clearRefreshLeft = false;
        var clearRefreshRight = false;

        function move(event) {
            console.log (jumpAllowed + ' ' + repeatAllowedLeft + ' ' + repeatAllowedRight)
            if (repeatAllowedLeft == true && (event.key === 'ArrowLeft' || event.key === 'a')) {
                repeatAllowedLeft = false;
                let accelCounter = 0;
                refreshLeft = setInterval(function() {
                    let box = document.getElementById('box');
                    let style = window.getComputedStyle(box);
                    let currentLeft = style.getPropertyValue('left').slice(0,-2);
                    box.style.left = (parseInt(currentLeft) - accelCounter) + 'px';
                    box.style.transform = 'scaleX(-1)';
                    if (accelCounter <= 5) {
                        accelCounter += 0.05;
                    }
                }, 1)
                for (accelCounter; accelCounter >=0; accelCounter -= 0.05) {
                    let box = document.getElementById('box');
                    let style = window.getComputedStyle(box);
                    let currentLeft = style.getPropertyValue('left').slice(0,-2);
                    box.style.left = (parseInt(currentLeft) - accelCounter) + 'px';
                    box.style.transform = 'scaleX(-1)';
                }
            } 

            if (repeatAllowedRight == true && (event.key == 'ArrowRight' || event.key === 'd')) {
                repeatAllowedRight = false;
                let accelCounter = 0;
                refreshRight = setInterval(function() {
                    let box = document.getElementById('box');
                    let style = window.getComputedStyle(box);
                    let currentLeft = style.getPropertyValue('left').slice(0,-2);
                    box.style.left = (parseInt(currentLeft) + accelCounter) + 'px';
                    box.style.transform = 'scaleX(1)';
                    if (accelCounter <= 5) {
                        accelCounter += 0.05;
                    }
                }, 1)
                for (accelCounter; accelCounter >=0; accelCounter -= 0.05) {
                    let box = document.getElementById('box');
                    let style = window.getComputedStyle(box);
                    let currentLeft = style.getPropertyValue('left').slice(0,-2);
                    box.style.left = (parseInt(currentLeft) + accelCounter) + 'px';
                    box.style.transform = 'scaleX(1)';
                }
            }

            if (jumpAllowed == true && (event.key === 'ArrowUp' || event.key === 'w')) {
                jumpAllowed = false;
                // repeatAllowedLeft = false;
                // repeatAllowedRight = false;
                let jumpFrameCounter = 1;
                let initialVelocity = 13;
                let gravity = 0.1;
                jump = setInterval(function() {
                    let box = document.getElementById('box');
                    let style = window.getComputedStyle(box);
                    let currentBottom = style.getPropertyValue('bottom').slice(0,-2);
                    let newBottom = Number(initialVelocity*jumpFrameCounter - gravity*jumpFrameCounter*jumpFrameCounter);
                    box.style.bottom = newBottom + 'px';
                    if (newBottom <= 0) {
                        clearInterval(jump);
                        box.style.bottom = '0px';
                        jumpAllowed = true;
                        // repeatAllowedLeft = true;
                        // repeatAllowedRight = true;
                    }
                    jumpFrameCounter += 1;
                },1)

            }
        }

        function stop(event) {

            if (( event.key === 'ArrowLeft' || event.key ==='a')) {
                    repeatAllowedLeft = true;
                    repeatAllowedRight = true;
                    clearInterval(refreshLeft)
            }

            if ((event.key === 'ArrowRight' || event.key === 'd')) {
                    repeatAllowedLeft = true;
                    repeatAllowedRight = true;
                    clearInterval(refreshRight)
                
            }
        }

    </script>
    
</body>
</html>